---
title: "BST 260 Group Project"
author: "Christina, Dena, Jack, Veronica, Whitney"
date: "11/22/2021"
output:
  html_document: default
  pdf_document: default
---

```{r}
#some basic packages that we will probably want: 
library(tidyverse)
library(lubridate)
library(rvest)

#package to read in xlsx files from a url:
library(openxlsx)
```

# Overview, Motivation, and Objectives

We seek to explore health disparities at the county level using the County Health Rankings - a program of the University of Wisconsin Population Health Institute. We chose this project as we are all interested in improving the quality and transparency of data analytics and visualizations that seek to describe health-related disparities and the structural determinants that contribute to them. We are also interested in better understanding best practices for using county-level data and small area based estimates as they are becoming increasingly popular in informing micro-level programs and policy decisions.

The overall goal of this project is to explore health-related disparities at the county level in the United States. 

The specific objectives are to:

* Describe health disparities at the county level using the County Health Rankings - a program of the University of Wisconsin Population Health Institute. 

* Explore ways to improve the quality and transparency of data analytics and visualizations that seek to describe health-related disparities and the structural determinants that contribute to them. 

* Highlight key drivers of health-related disparities in order to support decision-making and equitable resource allocation.

The outcomes of interest were life expectancy and drug-related overdose mortality. This project is a work in progress and health-related outcomes and associated drivers will continue to get added for future iterations. As a pilot, life expectancy and drug-related mortality are highlighted  as these were of particular interest to the research team. They also reflect outcomes that are pertinent to the current COVID-19 pandemic as drug overdose mortality has increased throughout the pandemic and counties with lower than average life expectancies are more vulnerable during the pandemic.

# Data and Analysis

In order to accomplish our goals, we completed 5 analyses:

1) We scraped data from multiple sources, cleaned and merged the appropriate columns for our outcomes and covariates of interest.

2) We conducted multiple types of data visualization to explore the range of outcomes data and their distribution across counties. This helped to highlight disparities. Data visualization of predictors of interest was also conducted to show their distribution across counties and allow for comparing predictors and outcomes using scatter plots in the interactive portion of our webpage.

3) We conducted generalized linear regression models and machine learning models (comparing logistic regression, naive bayes, and decision tree models) to identify modifiable variables of interest to local decision makers that are driving disparities in our outcomes of interest.

4) We developed a map to better visualize disparities across counties. As this project is focused on place-based inequities, we believed it was important to represent the data geographically and use different visualization techniques to help users better understand where the burden of disease may lie.

5) Finally, we developed a Shiny app to help users of the webpage better navigate the map and our predictors of interest. This app allows users to select counties of interest in order to see the relative burden of disease and to compare the strength of association across outcomes and variables of interest using an interactive scatter plot.

*Changes in our thinking process:* Some changes in our approach throughout the process included: the portions we chose to make interactive (after developing the map, we felt it would be a useful piece to be made interactive using a Shiny app), the presentation of Covid-19 related data (while we scraped Covid-19 data, we did not end up presenting it as we felt that it was no longer in line with our main objectives for the project and might distract from the outcomes and predictors of interest - however, we have kept the data available so that as we continue to work on the webpage, we can add more outcomes, including Covid-19 outcomes). 

# Related Work and Inspiration

We were inspired by the methods introduced in class including web scraping of available online data, data visualization methods, machine learning for predictive modeling, mapping technique to present place-based data, and Shiny app integrations to make data presentation more user-friendly. 

We were also motivated by what we viewed as place-based health challenges throughout the Covid-19 pandemic (making certain counties more vulnerable than others) and the dual epidemic of rising drug-related overdose mortality rate alongside rising Covid-19 cases. We believe that access to county-specific data to highlight health-related disparities and the distribution of social and structural determinants that contribute to them can be helpful in guiding local decision-making in addressing similar challenges in the future. 

Finally, we were inspired by the County Health Rankings data project and other similar efforts such as CDC Places that try to make small area-based estimates available to the public. It was an important learning experience to see how the choice of analysis and decisions made regarding what to visualize and how can play a significant role in what appears as important to end users (in this case, decision makers).

# Final Take-aways

Throughout our analyses, we learned several important things: 

* as expected, counties with higher rates of drug-related overdose mortality also exhibited lower average life expectancy.

* average life expectancy across counties in the US is normally distributed across a wide range (high disparity).

* drug-related overdose mortality has a right-skewed distribution with some counties experiencing very high rates.

* The three most important predictors of life expectency variations across counties based on the Decision Tree model included: percentage of population experiencing food insecurity, median household income, and percentage of population having some college education.

* The three most important predictors of drug-related overdose mortality variations across counties based on the Decision Tree model included: percentage of population experiencing insufficient sleep, percentage of population uninsured, and percentage of population unemployed.

* Using our shiny app, we can also see that some of these predictors display linear correlations with one another (eg. increasing food insecurity with decreasing median household income).

The rest of this document will display each analysis separately including code and notes.


# Analysis 1: Data scraping, cleaning and merging

Obtain County Health Ranking Data sheets, as well as county-level COVID data from NYT:

```{r}
#County Health Ranking Data:
dat <- read.xlsx("https://www.countyhealthrankings.org/sites/default/files/media/document/2021%20County%20Health%20Rankings%20Data%20-%20v1.xlsx", sheet = 4, startRow = 2)

#County Health Ranking Data second sheet:
dat2 <- read.xlsx("https://www.countyhealthrankings.org/sites/default/files/media/document/2021%20County%20Health%20Rankings%20Data%20-%20v1.xlsx", sheet = 6, startRow = 2)

#Cumulative County-level COVID data:
covid_dat <- read.csv(url("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"))
```

Web scraping for County names and population from Wikipedia:

```{r}

url <- "https://en.wikipedia.org/wiki/List_of_United_States_counties_and_county_equivalents"
tab = read_html(url) %>% html_nodes("table")

county_names <- c("county", "state", "population_2019", "delete")
counties <- tab %>% .[1] %>% html_table %>% .[[1]] %>% setNames(county_names)

counties <- counties %>% 
  select(!delete)

#make population_2019 numeric:
counties$population_2019 <- as.numeric(gsub(",","", counties$population_2019))

```

Data Manipulation and Merging:

```{r}
#Filter COVID data to most recent date, then arrange by state:
covid_dat <- covid_dat %>%
  filter(date == '2021-11-21') %>%
  select(!fips) %>%
  arrange(state)

#Make a list of the column names that we're interested in for dat:
columns <- c("FIPS",	"State",	"County", "Years.of.Potential.Life.Lost.Rate", "%.Fair.or.Poor.Health", "Average.Number.of.Physically.Unhealthy.Days",	"Average.Number.of.Mentally.Unhealthy.Days",	"%.Low.birthweight",	"%.Smokers", "%.Adults.with.Obesity",	"Food.Environment.Index",	"%.Physically.Inactive",	"%.With.Access.to.Exercise.Opportunities",	"%.Excessive.Drinking",	"#.Alcohol-Impaired.Driving.Deaths",	"#.Driving.Deaths",	"%.Driving.Deaths.with.Alcohol.Involvement",	"Chlamydia.Rate",	"Teen.Birth.Rate",	"%.Uninsured", "Primary.Care.Physicians.Rate",	"Primary.Care.Physicians.Ratio",	"Dentist.Rate",	"Dentist.Ratio",	"Mental.Health.Provider.Rate",	"Mental.Health.Provider.Ratio",	"Preventable.Hospitalization.Rate",	"%.With.Annual.Mammogram",	"%.Vaccinated",	"%.Completed.High.School",	"%.Some.College",	"%.Unemployed",	"%.Children.in.Poverty",	"Income.Ratio",	"%.Children.in.Single-Parent.Households",	"Social.Association.Rate", "Violent.Crime.Rate",	"Injury.Death.Rate",	"Average.Daily.PM2.5",	"Presence.of.Water.Violation", "%.Severe.Housing.Problems",	"%.Drive.Alone.to.Work", "%.Long.Commute.-.Drives.Alone")

#Keep only the columns from our list above, rename to match COVID data, arrange by state:
dat <- dat %>%
  select(columns) %>%
  rename(county = County) %>%
  rename(state = State) %>%
  rename(fips = FIPS) %>%
  arrange(state)

#Make a list of the column names we're interested in for dat2:
columns2 <- c("FIPS",	"State",	"County", "Life.Expectancy",	"Age-Adjusted.Death.Rate",	"Child.Mortality.Rate",	"Infant.Mortality.Rate",	"%.Frequent.Physical.Distress",	"%.Frequent.Mental.Distress",	"%.Adults.with.Diabetes",	"HIV.Prevalence.Rate",	"%.Food.Insecure",	"%.Limited.Access.to.Healthy.Foods",	"Drug.Overdose.Mortality.Rate",	"Motor.Vehicle.Mortality.Rate",	"%.Insufficient.Sleep",	"%.Disconnected.Youth",	"Average.Grade.Performance",	"Median.Household.Income",	"%.Enrolled.in.Free.or.Reduced.Lunch",	"Homicide.Rate",	"Suicide.Rate.(Age-Adjusted)",	"Firearm.Fatalities.Rate",	"Juvenile.Arrest.Rate",	"%.Homeowners",	"%.Broadband.Access",	"%.Female",	"%.Rural")

#Keep only the columns from our list above, rename to match COVID data, arrange by state:
dat2 <- dat2 %>%
  select(columns2) %>%
  rename(county = County) %>%
  rename(state = State) %>%
  rename(fips = FIPS) %>%
  arrange(state)

#Merge dat with dat2, then merge with COVID data:
dat <- dat %>%
  inner_join(dat2, by=c("county", "state"))

dat <- dat %>%
  left_join(covid_dat, by=c("county", "state"))

#Finally, merge dat with counties for population:
dat <- dat %>%
  left_join(counties, by=c("county", "state"))

```

# Analysis 2: Data Visualizations 

## Analysis 2.2: Boxplot of median household income per state

```{r}
##box plot of household income per state 
p <- dat %>% 
  mutate(state = reorder(state, Median.Household.Income, FUN = median)) %>%
  ggplot(aes(state, Median.Household.Income, fill = state)) +
  geom_boxplot() + 
  theme_bw() +
  ggtitle("Boxplots of Median Household Income by State")  +
  theme_update(plot.title = element_text(hjust = 0.6)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab("State") + ylab("Median Household Income")+
  theme(legend.position = "none")
p 


```

## Analysis 2.3: Life Expectancy

```{r}
#box plot of life expectancy by state
p2 <- dat %>% 
  mutate(state = reorder(state, Life.Expectancy, FUN = median), is.na(Life.Expectancy)) %>%
  ggplot(aes(x = reorder(state, Life.Expectancy), y = Life.Expectancy, fill = state)) +
  geom_boxplot() + 
  theme_bw() +
  theme(legend.position = "none") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5)) + 
  ggtitle("Boxplots of Life Expectancy by State") + 
  xlab("State") + ylab("Life Expectancy (years)")

p2


###Extra code to assess individual state statistics
#something <- dat %>% select(state, Life.Expectancy, county) %>% group_by(state) %>%
#                mutate(median_life = median(Life.Expectancy)) %>% ungroup()
#something

#something2 <- dat %>% filter(state == "Mississippi", !is.na(Life.Expectancy))
##something2
#median(something2$Life.Expectancy)

#code to determine distribution of life expectancy variable 
#mean(dat$Life.Expectancy, na.rm = TRUE)
#min(dat$Life.Expectancy, na.rm = TRUE)
#summary(dat$Life.Expectancy)


#selecting the top 24 counties with the lowest life expectancy
p3 <- dat %>% select(county, state, Life.Expectancy) %>% arrange(Life.Expectancy)%>% 
          filter(Life.Expectancy <= 69.7)

#creating a line plot of descending order of life expectancy
p4 <- p3 %>% ggplot(aes(x = reorder(county, -Life.Expectancy), y = Life.Expectancy, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Shortest Life Expectancy in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Life Expectancy (years)") 

#adding state abbreviations to county line plot
p4 + scale_x_discrete("U.S. County", labels = c("Oglala Lakota" = "Oglala Lakota (SD)", "Buffalo" = " Buffalo (SD)", "Corson" = "Corson (SD)", "Mellette" = " Mellette (SD)", "Covington City" = "Covington City (VA)" , "Kusilvak" = "Kusilvak (AK)", "Todd" = " Todd (SD)", "Petersburg City" = "Petersburg City (VA)", "Galax City" = "Galax City (VA)", "Roosevelt" = "Roosevelt (MT)", "Martinsville City" = "Martinsville City (VA)", "Dewey" = "Dewey (SD)", "Big Horn" = "Big Horn (MT)", "Union" = "Union (FL)", "Sioux" = "Sioux (ND)", "Perry" = "Perry (KY)",  "Kingman" = "Kingman (KS)", "McDowell" = "McDowell (WV)", "Edwards" = "Edwards (KS)", "Bennett" = "Bennett (SD)", "Owsley" = "Owsley (KY)", "Thurston" = "Thurston (NE)", "Breathitt" = "Breathitt (KY)", "Okfuskee" = "Okfuskee (OK)", "Logan" = "Logan (WV)"))

##histogram of life expectancy in the united states
p5 <- dat %>% ggplot(aes(x = Life.Expectancy)) +
              geom_histogram(binwidth = 0.2, color = "black", fill = "light blue") + 
              theme_bw()+ 
              ggtitle("Life Expectancy Distribution in the United States") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Life Expectancy (years)") 

p5 + geom_vline(aes(xintercept = mean(Life.Expectancy, na.rm = TRUE)), col='dark red',size=1)

#Code for distribution statistics 
#sd(dat$Life.Expectancy, na.rm = TRUE)
#mean(dat$Life.Expectancy, na.rm = TRUE)


```

## Analysis 2.4: Drug overdose mortality rate 

```{r}
#####Drug Overdose Mortality
#Histogram for drug overdose Mortality variable 
p6 <- dat %>% ggplot(aes(x = `Drug.Overdose.Mortality.Rate`)) +
              geom_histogram(binwidth = 0.75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Drug Overdose Mortality Rates per 100,000 population in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Drug Overdose Mortality Rate (per 100,000 population)") 
p6 + geom_vline(aes(xintercept = median(`Drug.Overdose.Mortality.Rate`, na.rm = TRUE)), col='dark red',size=1) 

#Code for distribution statistics 
#median(dat$`Drug.Overdose.Mortality.Rate`, na.rm = TRUE)
#IQR(dat$`Drug.Overdose.Mortality.Rate`, na.rm = TRUE)
#max(dat$`Drug.Overdose.Mortality.Rate`, na.rm = TRUE)

#boxplot of drug overdose mortality rate by state
p7 <- dat %>% 
  ggplot(aes(x = reorder(state, Drug.Overdose.Mortality.Rate) , y = Drug.Overdose.Mortality.Rate, fill = state))+
  geom_boxplot() + 
  theme_bw() +
  ggtitle("Boxplots of Drug Overdose Mortality Rate by State")  +
  theme_update(plot.title = element_text(hjust = 0.5)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5)) +
  theme(axis.text.y = element_text(size = 0.1)) + ##need to adjust the size of text 
  xlab("State") + ylab("Drug Overdose Mortality Rate per 100,000 Pop.")+ #change size of text
  theme(legend.position = "none")

p7 
###Extra code to assess individual state statistics
#something2 <- dat %>% filter(state == "West Virginia", !is.na(Drug.Overdose.Mortality.Rate))
#something2

#code to determine the top 25 counties with highest drug overdose mortality rate
p8 <- dat %>% select(county, state, Drug.Overdose.Mortality.Rate) %>% arrange(Drug.Overdose.Mortality.Rate) %>%
          filter(Drug.Overdose.Mortality.Rate >= 61) 

#creating a line plot of ascending order of drug overdose mortality rate
p9 <- p8 %>% ggplot(aes(x = reorder(county, Drug.Overdose.Mortality.Rate), y = Drug.Overdose.Mortality.Rate, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            theme(axis.text.y = element_text(size = 0.5)) +
            ggtitle("Top 25 Counties With the Highest Drug Overdose Mortality Ratio in the U.S.") +
            xlab("U.S County") + ylab("Drug Overdose Mortality Ratio (per 100,000 pop.)") 

#adding state abbreviations to county line plot
p9 + scale_x_discrete("U.S. County", labels = c("Kenton" = "Kenton (KY)", "Lake" = " Lake (CA)", "Cheatham" = "Cheatham (TN)", "Hampshire" = " Hampshire (WV)", "Owen" = "Owen (KY)", "Gallia" = "Gallia (OH)", "Lincoln" = "Lincoln (WV)", "Boyd" = "Boyd (KY)", "Union" = "Union (IN)", "Estill" = "Estill (KY)", "Fayette" = "Fayette (WV) & (IN)", "Mahnomen" = "Mahnomen (MN)", "Cecil" = "Cecil (MD)", "Montgomery" = "Montgomery (OH)", "Kanawha" = "Kanawha (WV)", "Gallatin" = "Gallatin (KY)", "Boone" = "Boone (WV)", "Rio Arriba" = "Rio Arriba (NM)", "Raleigh" = "Raleigh (WV)", "Wayne" = "Wayne	(IN)", "Scioto" = "Scioto (OH)", "Logan" = "Logan (WV)", "Wayne" = "Wayne (WV)", "Cabell" = "Cabell (WV)", "Berkeley" = "Berkeley (WV)"))


```

## Analysis 2.5: Scatter plot of life expectancy vs. drug over dose mortality rate

```{r}
###Scatter plot of drug over dose mortality and life expectancy 
p10 <- dat %>% ggplot(aes(x = Drug.Overdose.Mortality.Rate, y = Life.Expectancy)) +
            geom_point(size = 1) + 
            ggtitle("Scatter Plot of Life Expectancy vs. Drug Overdose Mortality Rate (per 100,000 population)") +
            theme(plot.title = element_text(size = 10)) + 
            xlab("Drug Overdose Mortality Rate (per 100,000 population)") + 
            ylab("Life Expectancy (years)") 

#adding a trend line to the scatter plot     
p10 + geom_smooth(method = "lm")

```

## Analysis 2.6: Food Insecurity

```{r}
####Food Insecurity
#histogram of food insecurity
p_food <- dat %>% ggplot(aes(x = `%.Food.Insecure`)) +
              geom_histogram(binwidth = 0.75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Food Insecurity % in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Food Insecurity %") 

#code to add line where the mean value is located 
p_food + geom_vline(aes(xintercept = mean(`%.Food.Insecure`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#mean(dat$`%.Food.Insecure`, na.rm = TRUE)
#sd(dat$`%.Food.Insecure`, na.rm = TRUE)

#selecting the top 25 counties with the highest food insecurity %
p11 <- dat %>% select(county, state, `%.Food.Insecure`) %>% arrange(`%.Food.Insecure`)%>% 
          filter(`%.Food.Insecure` >= 23.9)

#creating a line plot of ascending order of food insecurity %
p12 <- p11 %>% ggplot(aes(x = reorder(county, `%.Food.Insecure`), y = `%.Food.Insecure`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Food Insecurity % in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Food Insecurity %") 

#adding state abbreviations to county line plot
p12 + scale_x_discrete("U.S. County", labels = c("Chicot" = "Chicot (AR)", "Coahoma" = "Coahoma (MS)", "Bolivar" = "Bolivar (MS)", "Clay" = " Clay (GA) & Clay (KY)", "Leflore" = "Leflore (MS)", "Wolfe" = "Wolfe (KY)", "Washington" = "Washington (MS)", "Breathitt" = "Breathitt (KY)", "Wilcox" = "Wilcox (AL)", "Bell" = "Bell (KY)", "Magoffin" = "Magoffin (KY)", "Harlan" = "Harlan (KY)", "Wilkinson" = "Wilkinson (MS)", "Quitman" = "Quitman (MS)", "Phillips" = "Phillips (AR)", "Todd" = "Todd (SD)", "Greene" = "Greene (AL)", "Humphreys" = "Humphreys (MS)", "Oglala Lakota" = "Oglala Lakota (SD)", "Perry" = "Perry (AL)", "Claiborne" = "Claiborne (MS)", "Holmes" = "Holmes (MS)", "Issaquena" = "Issaquena (MS)", "Jefferson" = "Jefferson (MS)"))

```

## Analysis 2.7: Severe Housing Problems 

```{r}
#histogram of severe housing problems
p_housing <- dat %>% ggplot(aes(x = `%.Severe.Housing.Problems`)) +
              geom_histogram(binwidth = 0.75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Severe Housing % in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Severe Housing Probelms %") 

#code to add line where the mean value is located 
p_housing + geom_vline(aes(xintercept = mean(`%.Severe.Housing.Problems`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#mean(dat$`%.Severe.Housing.Problems`, na.rm = TRUE)
#sd(dat$`%.Severe.Housing.Problems`, na.rm = TRUE)

#selecting the top 25 counties with the highest severe housing problems %
p13 <- dat %>% select(county, state, `%.Severe.Housing.Problems`) %>% arrange(`%.Severe.Housing.Problems`)%>% 
          filter(`%.Severe.Housing.Problems` >= 26.43805)

#creating a line plot of ascending order of housing problems in top 25 counties 
p14 <- p13 %>% ggplot(aes(x = reorder(county, `%.Severe.Housing.Problems`), y = `%.Severe.Housing.Problems`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Severe Housing Problems % in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Severe Housing Problems %") 

#adding state abbreviations to county line plot
p14 + scale_x_discrete("U.S. County", labels = c("Imperial" = "Imperial (CA)", "Mendocino" = "Mendocino (CA)", "Tunica" = "Tunica (MS)", "Rockland" = " Rockland (NY)", "Orange" = "Orange (CA)", "Ziebach" = "Ziebach (SD)", "Fresno" = "Fresno (CA)", "Tulare" = "Tulare (CA)", "Santa Cruz" = "Santa Cruz (CA)", "Todd" = "Todd (SD)", "Essex" = "Essex (NJ)", "Alpine" = "Alpine (CA)", "Hudson" = "Hudson (NJ)", "San Miguel" = "San Miguel (CO)", "McKinley" = "McKinley (NM)", "Webb" = "Webb (TX)", "Santa Barbara" = "Santa Barbara (CA)", "Buffalo" = "Buffalo (SD)", "Monterey" = "Monterey (CA)", "Miami-Dade" = "Miami-Dade (FL)", "Passaic" = "Passaic (NJ)", "Apache" = "Apache (AZ)", "Madison" = "Madison (ID)", "Los Angeles" = "Los Angeles (CA)", "Oglala Lakota" = "Oglala Lakota	(SD)"))

```

## Analysis 2.8: Some College 

```{r}
#histogram of some college variable 
p_college <- dat %>% ggplot(aes(x = `%.Some.College`)) +
              geom_histogram(binwidth = 0.75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Some College % in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Some College %") 

#code to add line where the mean value is located 
p_college + geom_vline(aes(xintercept = mean(`%.Some.College`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#mean(dat$`%.Some.College`, na.rm = TRUE)
#sd(dat$`%.Some.College`, na.rm = TRUE)


#selecting the top 25 counties with the lowest some college %
p14 <- dat %>% select(county, state, `%.Some.College`) %>% arrange(`%.Some.College`)%>%
          filter(`%.Some.College` < 29.86)

#line plot for uninsured in the top 25 counties
p15 <- p14 %>% ggplot(aes(x = reorder(county, -`%.Some.College`), y = `%.Some.College`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Lowest Some College % in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Some College %") 

#adding state abbreviations to county line plot
p15 + scale_x_discrete("U.S. County", labels = c("Kenedy" = "Kenedy (TX)", "Jeff Davis" = "Jeff Davis (TX)", "La Salle" = "La Salle (TX)", "Forest" = " Forest (PA)", "Holmes" = "Holmes (OH)", "Taliaferro" = "Taliaferro (GA)", "Kusilvak" = "Kusilvak (AK)", "DeSoto" = "DeSoto (FL)", "Hudspeth" = "Hudspeth (TX)", "Lincoln" = "Lincoln (CO)", "Hancock" = "Hancock (GA)", "Tensas" = "Tensas (LA)", "McDowell" = "McDowell (WV)", "Garza" = "Garza (TX)", "Telfair" = "Telfair (GA)", "Hamilton" = "Hamilton (FL)", "Hardee" = "Hardee (FL)", "Stewart" = "Stewart (GA)", "East Carroll" = "East Carroll (LA)", "LaGrange" = "LaGrange (IN)", "Bent" = "Bent (CO)", "Real" = "Real (TX)", "Glades" = "Glades (FL)", "Issaquena" = "Issaquena (MS)", "Wolfe" = "Wolfe (KY)", "Gaines" = "Gaines (TX)", "Lake" = "Lake (TN)", "Menard" = "Menard	(TX)"))

```

## Analysis 2.9: Uninsured

```{r}
#histogram of uninsured variable 
p_uninsured <- dat %>% ggplot(aes(x = `%.Uninsured`)) +
              geom_histogram(binwidth = 0.75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Uninsured % in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Uninsured %") 

#code to add line where the median value is located 
p_uninsured + geom_vline(aes(xintercept = median(`%.Uninsured`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#median(dat$`%.Uninsured`, na.rm = TRUE)
#IQR(dat$`%.Uninsured`, na.rm = TRUE)

#selecting the top 25 counties with the highest uninsured %
p16 <- dat %>% select(county, state, `%.Uninsured`) %>% arrange(desc(`%.Uninsured`))%>%
          filter(`%.Uninsured` > 27.1)

#line plot for uninsured in the top 25 counties
p17 <- p16 %>% ggplot(aes(x = reorder(county, `%.Uninsured`), y = `%.Uninsured`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Uninsured % in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Uninsured %") 

#adding state abbreviations to county line plot
p17 + scale_x_discrete("U.S. County", labels = c("Gaines" = "Gaines (TX)", "Hidalgo" = "Hidalgo (TX)", "Presidio" = "Presidio (TX)", "Cameron" = " Cameron (TX)", "Dallam" = "Dallam (TX)", "Collingsworth" = "Collingsworth (TX)", "Starr" = "Starr (TX)", "Webb" = "Webb (TX)", "Jeff Davis" = "Jeff Davis (TX)", "Bailey" = "Bailey (TX)", "Castro" = "Castro (TX)", "Zapata" = "Zapata (TX)", "Hall" = "Hall (TX)", "Menard" = "Menard (TX)", "Sherman" = "Sherman (TX)", "Hudspeth" = "Hudspeth (TX)", "Parmer" = "Parmer (TX)", "San Saba" = "San Saba (TX)", "Lipscomb" = "Lipscomb (TX)", "Hansford" = "Hansford (TX)", "Maverick" = "Maverick (TX)", "Mason" = "Mason (TX)", "Hendry" = "Hendry (FL)", "Ochiltree" = "Ochiltree (TX)", "Clark" = "Clark	(ID)"))
```

## Analysis 2.10: Unemployment 

```{r}
#histogram of unemployment variable 
p_unemployed <- dat %>% ggplot(aes(x = `%.Unemployed`)) +
              geom_histogram(binwidth = 0.75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Unemployed % in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Unemployed %") 

#code to add line where the median value is located 
p_unemployed + geom_vline(aes(xintercept = median(`%.Unemployed`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#median(dat$`%.Unemployed`, na.rm = TRUE)
#IQR(dat$`%.Unemployed`, na.rm = TRUE)

#selecting the top 25 counties with the highest violence crime rate 
p18 <- dat %>% select(county, state, `%.Unemployed`) %>% arrange(desc(`%.Unemployed`))%>%
              filter(`%.Unemployed` > 8.6)

#line plot for violent crime rate in the top 25 counties
p19 <- p18 %>% ggplot(aes(x = reorder(county, `%.Unemployed`), y = `%.Unemployed`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Unemployed % in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Unemployment %") 

#adding state abbreviations to county line plot
p19 + scale_x_discrete("U.S. County", labels = c("Imperial" = "Imperial (CA)", "Yuma" = "Yuma (AZ)", "Jefferson" = "Jefferson (MS)", "Calhoun" = "Calhoun (WV)", "Colusa" = "Colusa (CA)", "Luna" = "Luna (NM)", "Ferry" = "Ferry (WA)", "Issaquena" = "Issaquena (MS)", "Magoffin" = "Magoffin (KY)", "Claiborne" = "Claiborne (MS)", "Holmes" = "Holmes (MS)", "Wilkinson" = "Wilkinson (MS)", "Humphreys" = "Humphreys (MS)", "Apache" = "Apache (AZ)", "Starr" = "Starr (TX)", "Oglala Lakota" = "Oglala Lakota (SD)", "Tulare" = "Tulare (CA)", "Harlan" = "Harlan (KY)", "Roane" = "Roane (WV)", "Telfair" = "Telfair (GA)", "Mackinac" = "Mackinac (MI)", "McDowell" = "McDowell (WV)", "Lewis" = "Lewis (KY)", "Sunflower" = "Sunflower (MS)", "Cheboygan" = "Cheboygan	(MI)"))
```

## Analysis 2.11: Violent Crime Rate 

```{r}
#histogram of violent crime rate variable 
p_violence <- dat %>% ggplot(aes(x = `Violent.Crime.Rate`)) +
              geom_histogram(binwidth = 75, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Violent Crime Rate in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Violent Crime Rate") 
#code to add line where the mean value is located 
p_violence + geom_vline(aes(xintercept = median(`Violent.Crime.Rate`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#median(dat$`Violent.Crime.Rate`, na.rm = TRUE)
#IQR(dat$`Violent.Crime.Rate`, na.rm = TRUE)

#selecting the top 25 counties with the highest violence crime rate 
p20 <- dat %>% select(county, state, `Violent.Crime.Rate`) %>% arrange(desc(`Violent.Crime.Rate`))%>%
              filter(`Violent.Crime.Rate` > 894)

#line plot for violent crime rate in the top 25 counties
p21 <- p20 %>% ggplot(aes(x = reorder(county, `Violent.Crime.Rate`), y = `Violent.Crime.Rate`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Violent Crime Rate in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Rate per 100,000 population") 

#adding state abbreviations to county line plot
p21 + scale_x_discrete("U.S. County", labels = c("Calhoun" = "Calhoun (GA)", "Shelby" = "Shelby (TN)", "Alexander" = "Alexander (IL)", "Turner" = "Turner (GA)", "Crittenden" = "Crittenden (AR)", "Marion" = "Marion (IN)", "Phillips" = "Phillips (AR)", "Davidson" = "Davidson (TN)", "Haywood" = "Haywood (TN)", "Levy" = "Levy (FL)", "Pulaski" = "Pulaski (AR)", "Milwaukee" = "Milwaukee (WI)", "Wayne" = "Wayne (MI)", "Jefferson" = "Jefferson (AR)", "Mississippi" = "Mississippi (AR)", "Kenedy" = "Kenedy (TX)", "Bernalillo" = "Bernalillo (NM)", "Jackson" = "Jackson (MO)", "Dougherty" = "Dougherty (GA)", "Scott" = "Scott (MO)", "Dallas" = "Dallas (AL)", "Valencia" = "Valencia (NM)", "Taylor" = "Taylor (FL)", "Dillon" = "Dillon (SC)", "Marlboro" = "Marlboro (SC)"))


```

## Analysis 2.12: Insufficient Sleep

```{r}
#histogram of insufficient sleep variable 
p_sleep <- dat %>% ggplot(aes(x = `%.Insufficient.Sleep`)) +
              geom_histogram(binwidth = 1, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Insufficient Sleep % in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Insufficient Sleep %") 

#code to add line where the mean value is located 
p_sleep + geom_vline(aes(xintercept = mean(`%.Insufficient.Sleep`, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#mean(dat$`%.Insufficient.Sleep`, na.rm = TRUE)
#sd(dat$`%.Insufficient.Sleep`, na.rm = TRUE)

#selecting the top 25 counties with the highest values of insufficient sleep 
p22 <- dat %>% select(county, state, `%.Insufficient.Sleep`) %>% arrange(desc(`%.Insufficient.Sleep`))%>%
              filter(`%.Insufficient.Sleep` > 45.7)

#line plot for insufficient sleep in the top 25 counties 
p23 <- p22 %>% ggplot(aes(x = reorder(county, `%.Insufficient.Sleep`), y = `%.Insufficient.Sleep`, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Insufficient Sleep % in the United States") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Insufficient Sleep %") 

#adding state abbreviations to county line plot
p23 + scale_x_discrete("U.S. County", labels = c("McCreary" = "McCreary (KY)", "Mingo" = "Mingo (WV)", "Greene" = "Greene (AL)", "Boone" = "Boone (WV)", "Pike" = "Pike (KY)", "Hardeman" = "Hardeman (TN)", "McDowell" = "McDowell (WV)", "Clay" = "Clay (KY)", "Letcher" = "Letcher (KY)", "Harlan" = "Harlan (KY)", "Wayne" = "Wayne (WV)", "Clay" = "Clay (GA) and (KY)", "Lowndes" = "Lowndes (AL)", "Logan" = "Logan (WV)", "Lauderdale" = "Lauderdale (TN)", "Summers" = "Summers (WV)", "Jefferson" = "Jefferson (MS)", "Haywood" = "Haywood (TN)", "Martin" = "Martin (KY)", "Hancock" = "Hancock (GA)", "Shelby" = "Shelby (TN)", "Lake" = "Lake (TN)", "Macon" = "Macon (GA)", "Boyd" = "Boyd (KY)", "Breathitt" = "Breathitt (KY)"))
```

## Analysis 2.13: Average Daily PM 2.5 

```{r}
#histogram of average daily PM 2.5 values 
p_pm <- dat %>% ggplot(aes(x = Average.Daily.PM2.5)) +
              geom_histogram(binwidth = 1, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Average Daily PM 2.5 in the U.S.") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Average Daily 2.5") 

#code to add line where the median value is located 
p_pm + geom_vline(aes(xintercept = median(Average.Daily.PM2.5, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#median(dat$Average.Daily.PM2.5, na.rm = TRUE)
#IQR(dat$Average.Daily.PM2.5, na.rm = TRUE)

#selecting the top 25 counties with the highest pm 2.5 values 
p24 <- dat %>% select(county, state, Average.Daily.PM2.5) %>% arrange(desc(Average.Daily.PM2.5))%>%
              filter(Average.Daily.PM2.5 > 11.1)

#code for the average daily pm 2.5 values in ascending order with top 25 counties 
p25 <- p24 %>% ggplot(aes(x = reorder(county, Average.Daily.PM2.5), y = Average.Daily.PM2.5, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Highest Average Daily PM 2.5") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Average Daily PM 2.5 micrograms per cubic meter") 

#adding state abbreviations to county line plot
p25 + scale_x_discrete("U.S. County", labels = c("Kern" = "Kern (CA)", "Kings" = "Kings (CA)", "San Bernardino" = "San Bernardino (CA)", "Tulare" = "Tulare (CA)", "Fresno" = "Fresno (CA)", "Riverside" = "Riverside (CA)", "San Joaquin" = "San Joaquin (CA)", "Plumas" = "Plumas (CA)", "Allegheny" = "Allegheny (PA)", "Stanislaus" = "Stanislaus (CA)", "Imperial" = "Imperial (CA)", "Pinal" = "Pinal (AZ)", "Jefferson" = "Jefferson (OH)", "Lebanon" = "Lebanon (PA)", "Madera" = "Madera (CA)", "DeKalb" = "DeKalb (GA)", "Los Angeles" = "Los Angeles (CA)", "Merced" = "Merced (CA)", "Lemhi" = "Lemhi (ID)", "Butler" = "Butler (OH)", "Shelby" = "Shelby (AL)", "Lancaster" = "Lancaster (PA)", "Wayne" = "Wayne (MI)", "Berks" = "Berks (PA)", "Montgomery" = "Montgomery (PA)"))


```

## Analysis 2.14: Median Household Income

```{r}
#histogram of median household income
p_income <- dat %>% ggplot(aes(x = Median.Household.Income)) +
              geom_histogram(binwidth = 1000, color = "black", fill = "gray") + 
              theme_bw()+ 
              ggtitle("Distribution of Median Household Income in the United States") +
              theme(plot.title = element_text(hjust = 0.5)) +
              xlab("Median Household Income") 

#addition a line where the median value is located 
p_income + geom_vline(aes(xintercept = median(Median.Household.Income, na.rm = TRUE)), col='dark red',size=1) 

#code for distribution statistics 
#median(dat$Median.Household.Income, na.rm = TRUE)
#IQR(dat$Median.Household.Income, na.rm = TRUE)


#code to determine the top 25 counties with the lowest median household income 
p26 <- dat %>% select(county, state, Median.Household.Income) %>% arrange(Median.Household.Income)%>%
              filter(Median.Household.Income < 31221)

#line plot in decsending order of median household income with the top 25 counties
p27 <- p26 %>% ggplot(aes(x = reorder(county, -Median.Household.Income), y = Median.Household.Income, group = 1)) +
            geom_point() +
            geom_line() + 
            theme_bw() + 
            ggtitle("Top 25 Counties With the Lowest Median Household Income") +
            theme(plot.title = element_text(hjust = 0.5)) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
            xlab("U.S County") + ylab("Median Household Income") 

#adding state abbreviations to county line plot
p27 + scale_x_discrete("U.S. County", labels = c("Clay" = "Clay (GA) & (KY)", "Holmes" = "Holmes (MS)", "Buffalo" = "Buffalo (SD)", "Taylor" = "Taylor (GA)", "Humphreys" = "Humphreys (MS)", "Greene" = "Greene (AL)", "Owsley" = "Owsley (KY)", "McDowell" = "McDowell (WV)", "Sumter" = "Sumter (AL)", "Quitman" = "Quitman (MS)", "Perry" = "Perry (AL)", "Leflore" = "Leflore (MS)", "Harlan" = "Harlan (KY)", "Clay" = "Clay (KY) & (GA)", "Coahoma" = "Coahoma (MS)", "Bolivar" = "Bolivar (MS)", "Lee" = "Lee (AR)", "Jefferson" = "Jefferson (MS)", "Lee" = "Lee (KY)", "Bell" = "Bell (KY)", "Issaquena" = "Issaquena (MS)", "Wilcox" = "Wilcox (MS)", "Washington" = "Washington (MS)", "Sharkey" = "Sharkey (MS)", "Johnson" = "Johnson (KY)"))

```

Outcome:

Our two primary outcomes were life expectancy and drug overdose mortality rate per 100,000 population. We created visualizations of the distribution of each outcome across the United States, by state, and then we determined the top 25 counties with the lowest life expectancy and the top 25 counties with the highest drug overdose mortality rate. We prioritized the histogram and line plots of the 25 counties for each predictor because our overall predictions were using county-level data. Depending on the distribution of the histogram of the variable of interest, the mean and the standard deviation were calculated, or the median and the interquartile range were calculated. We chose these metrics as these are the standard ways to summarize the distribution of variable. As we had county level data, we wanted to ensure that our analyses had a focus at the country level. there were no major changes to our initial ideas. We also wanted to show the relationship between our two main outcome variables, and that is why the scatter plot with the trend line was generated. 

# Analysis 3: Prediction models

## Analysis 3.1: linear regression

## The goal of this section was to identify the machine learning model that best predicts the outcomes of interest 

The built environment and place-based policies play important roles in life expectancy. They are also important factors in many of the epidemics facing America, including drug-related overdose mortality. It would be helpful to know what factors related to county-level characteristics help to predict differences in life expectancies and drug-related overdose mortality. 

Approach: To run a simple linear regression model to understand what covariates might be significant and then to use correlation plots to pick up on potential collinearities and identify modifiable predictors that are still highly correlated with the outcomes of interest to include in the machine learning prediction models. Selected covariates for the machine learning models were based on subject matter knowledge, expectations of modifiability with government/grassroots intervention, and strengths of association from linear models and correlation plots.

Inspiration: Class sessions on logistic models, Naive Bayes, and Decision trees informed the prediction modeling approach. The outcomes were dichotomized as being below or above average life expectancy and drug overdose mortality respectively. 

```{r}

# prediction model

# We will be using data from the county health rankings to explore predictors for life expectancy using the following variables:

# Fair or Poor Health
# Average number of physically unhealthy days
# Average number of mentally unhealthy days
# low birthweight
# smoking status
# adults with obesity
# food environment index
# mental health provider rate 
# percent completed high school
# percent completed college
# percent unemployed
# violent crime rate 
# average daily PM 2.5
# Severe housing problems
# Median Household Income

# subset data to use for prediction model 

pred_dat <- dat %>% select(Life.Expectancy, `%.Fair.or.Poor.Health`, `Average.Number.of.Physically.Unhealthy.Days`,	`Average.Number.of.Mentally.Unhealthy.Days`,	`%.Low.birthweight`,	`%.Smokers`, `%.Adults.with.Obesity`,	`%.Food.Insecure`,	`%.Physically.Inactive`,	`%.Excessive.Drinking`,	`%.Uninsured`, `Primary.Care.Physicians.Rate`,	Mental.Health.Provider.Rate,	`%.Completed.High.School`, `%.Some.College`,	`%.Unemployed`,	Median.Household.Income, Violent.Crime.Rate, Average.Daily.PM2.5, `%.Severe.Housing.Problems`) %>% arrange(Life.Expectancy) %>% drop_na()

# create correlation plot 

library(GGally)
library(ggplot2)
corr <- cor(pred_dat)
ggcorr(corr, 
       label = T, 
       label_size = 2,
       label_round = 2,
       hjust = 1,
       size = 3, 
       color = "royalblue",
       layout.exp = 5,
       low = "red", 
       mid = "white", 
       high = "blue",
       name = "Correlation")

# We will be using data from the county health rankings to explore predictors for the drug-related overdose mortality outcomes using the following variables:

# Frequent.Physical.Distress
# Frequent.Mental.Distress
# percentage of Smokers
# percentage Food Insecure
# percentage Physically Inactive
# percentage Excessive Drinking
# percentage Uninsured
# Primary.Care.Physicians.Rate
# Mental.Health.Provider.Rate
# percentage Completed.High.School
# percentage completed Some.College
# percentage Unemployed
# SES, Median.Household.Income
# Violent.Crime.Rate
# percentage Insufficient.Sleep
# percentage Severe.Housing.Problems
# Life.Expectancy

# subset prediction data 

pred_dat2 <- dat %>% select(Drug.Overdose.Mortality.Rate,`%.Frequent.Physical.Distress`, `%.Frequent.Mental.Distress`,	`%.Smokers`, `%.Food.Insecure`,	`%.Physically.Inactive`,	`%.Excessive.Drinking`,	`%.Uninsured`, `Primary.Care.Physicians.Rate`,	Mental.Health.Provider.Rate,	`%.Completed.High.School`, `%.Some.College`,	`%.Unemployed`,	Median.Household.Income, Violent.Crime.Rate, `%.Insufficient.Sleep`, `%.Severe.Housing.Problems`, Life.Expectancy) %>% arrange(Drug.Overdose.Mortality.Rate) %>% drop_na()

# correlation plot
corr2 <- cor(pred_dat2)
ggcorr(corr2, 
       label = T, 
       label_size = 2,
       label_round = 2,
       hjust = 1,
       size = 3, 
       color = "royalblue",
       layout.exp = 5,
       low = "red", 
       mid = "white", 
       high = "blue",
       name = "Correlation")

# fit linear prediction model for life expectancy 

pred_fit <- glm(Life.Expectancy ~ ., data=pred_dat)
summary(pred_fit)

# fit linear prediction model for overdose mortality 

pred_fit2 <- glm(Drug.Overdose.Mortality.Rate ~ ., data=pred_dat2)
summary(pred_fit2)

# identify average life expectancy and overdose mortality to dichotomize variables 
avg.overdose <- mean(pred_dat2$Drug.Overdose.Mortality.Rate)
avg.overdose
avg.life <- mean(pred_dat$Life.Expectancy)
avg.life

# create data sets with dichotomized variables for outcomes of interest

pred_dat <- pred_dat %>% mutate(life_exp = ifelse(Life.Expectancy >= avg.life, 0, 1))

pred_dat2 <- pred_dat2 %>% mutate(overdose = ifelse(Drug.Overdose.Mortality.Rate >= avg.overdose, 1, 0))
```

## Analysis 3.2: machine learning models

```{r}
# prediction models 

library(tidyverse)
library(splitstackshape)
library(caret)
library(e1071)
library(pROC)
library(dplyr)
library(ggplot2)
remotes::update_packages("rlang")

set.seed(1)

# come up with training and test sets 
x <- stratified(pred_dat, "life_exp", 0.7, keep.rownames = TRUE)
train_set <- x %>% dplyr::select(-rn)
train_index <- as.numeric(x$rn)
test_set <- pred_dat[-train_index,]

dim(train_set)
dim(test_set)

## Logistic regression model (covariates selected based on relevance to policy/decision-making and correlation to outcomes)
fit <-  glm(life_exp ~ `%.Food.Insecure` +	`%.Uninsured` + `%.Some.College` +	`%.Unemployed` +	Median.Household.Income + Violent.Crime.Rate + Average.Daily.PM2.5 + `%.Severe.Housing.Problems`, data= train_set, family="binomial")

p_hat <- predict(fit, newdata = test_set, type="response")
y_hat <- ifelse(p_hat > 0.5, 1, 0)

# confusion matrix
CF <- confusionMatrix(data = as.factor(y_hat), reference = as.factor(test_set$life_exp), positive = '1')
CF

## Naive Bayes model
set.seed(1)
nb_fit <-  naiveBayes(life_exp ~ `%.Food.Insecure` +	`%.Uninsured` + `%.Some.College` +	`%.Unemployed` +	Median.Household.Income + Violent.Crime.Rate + Average.Daily.PM2.5 + `%.Severe.Housing.Problems`, data = train_set)

p_hat_nb <- predict(nb_fit, test_set, type = "raw")[,2]
y_hat_nb <- factor(ifelse(p_hat_nb > 0.5, 1, 0))

# confusion matrix
CFnb <- confusionMatrix(data = as.factor(y_hat_nb), reference = as.factor(test_set$life_exp), positive = '1')
CFnb

## decision tree model
library(rpart)
set.seed(1)
train_set <- train_set  %>% dplyr::select(., life_exp, `%.Food.Insecure` ,	`%.Uninsured` , `%.Some.College` ,	`%.Unemployed`,	Median.Household.Income , Violent.Crime.Rate , Average.Daily.PM2.5 , `%.Severe.Housing.Problems`)
tree_fit <- rpart(as.factor(life_exp) ~ ., data = train_set)
tree_preds <- predict(tree_fit, newdata = test_set, type = "class")

# confusion matrix
CFtree <- confusionMatrix(data = as.factor(tree_preds), reference = as.factor(test_set$life_exp), positive='1')
CFtree

# logistic life exp

roc_log <- roc(test_set$life_exp, y_hat)

# nb life exp

roc_nb <- roc(as.factor(test_set$life_exp), p_hat_nb)

# decision tree life exp
tree_preds <- predict(tree_fit, newdata = test_set, type = "prob")[,2]
roc_dt <- roc(test_set$life_exp, tree_preds)


# ROCs for life expectancy

ggroc(list("Logistic" = roc_log, "Naive Bayes" = roc_nb, "Decision Tree" = roc_dt)) +
  theme(legend.title = element_blank()) +
  geom_segment(aes(x = 1, xend = 0, y = 0, yend = 1), color = "black", linetype = "dashed") +
  xlab("Sensitivity") +
  ylab("Specificity")+
  ggtitle("Compare ROCs for Life Expectancy")+
  theme(plot.title = element_text(hjust = 0.5))

# overdose mortality

# creat training and test sets

x2 <- stratified(pred_dat2, "overdose", 0.7, keep.rownames = TRUE)
train_set2 <- x2 %>% dplyr::select(-rn)
train_index2 <- as.numeric(x2$rn)
test_set2 <- pred_dat2[-train_index2,]

dim(train_set2)
dim(test_set2)

## Logistic regression model (covariates selected based on relevance to policy/decision-making and correlation to outcomes)
fit2 <-  glm(overdose ~ `%.Food.Insecure`+	`%.Uninsured`+	`%.Some.College`+	`%.Unemployed`+	Median.Household.Income+ Violent.Crime.Rate+ `%.Insufficient.Sleep`, `%.Severe.Housing.Problems`, data= train_set2, family="binomial")

p_hat2 <- predict(fit2, newdata = test_set2, type="response")
y_hat2 <- ifelse(p_hat2 > 0.5, 1, 0)

# confusion matrix
CF2 <- confusionMatrix(data = as.factor(y_hat2), reference = as.factor(test_set2$overdose), positive = '1')
CF2

## Naive Bayes model
set.seed(1)
nb_fit2 <-  naiveBayes(overdose ~ `%.Food.Insecure`+	`%.Uninsured`+	`%.Some.College`+	`%.Unemployed`+	Median.Household.Income+ Violent.Crime.Rate+ `%.Insufficient.Sleep`+ `%.Severe.Housing.Problems`, data = train_set2)

p_hat_nb2 <- predict(nb_fit2, test_set2, type = "raw")[,2]
y_hat_nb2 <- factor(ifelse(p_hat_nb2 > 0.5, 1, 0))

# confusion matrix
CFnb2 <- confusionMatrix(data = as.factor(y_hat_nb2), reference = as.factor(test_set2$overdose), positive = '1')
CFnb2

## decision tree model
library(rpart)
set.seed(1)
train_set2 <- train_set2  %>% dplyr::select(., overdose, `%.Food.Insecure`,	`%.Uninsured`,	`%.Some.College`,	`%.Unemployed`,	Median.Household.Income, Violent.Crime.Rate, `%.Insufficient.Sleep`, `%.Severe.Housing.Problems`)
tree_fit2 <- rpart(as.factor(overdose) ~ ., data = train_set2)
tree_preds2 <- predict(tree_fit2, newdata = test_set2, type = "class")

# confusion matrix
CFtree2 <- confusionMatrix(data = as.factor(tree_preds2), reference = as.factor(test_set2$overdose), positive='1')
CFtree2

# logistic overdose

roc_log2 <- roc(test_set2$overdose, y_hat2)

# nb overdose

roc_nb2 <- roc(as.factor(test_set2$overdose), p_hat_nb2)

# decision tree overdose
tree_preds2 <- predict(tree_fit2, newdata = test_set2, type = "prob")[,2]
roc_dt2 <- roc(test_set2$overdose, tree_preds2)

# ROCs overdose

ggroc(list("Logistic" = roc_log2, "Naive Bayes" = roc_nb2, "Decision Tree" = roc_dt2)) +
  theme(legend.title = element_blank()) +
  geom_segment(aes(x = 1, xend = 0, y = 0, yend = 1), color = "black", linetype = "dashed") +
  xlab("Sensitivity") +
  ylab("Specificity")+
  ggtitle("Compare ROCs for Overdose Mortality")+
  theme(plot.title = element_text(hjust = 0.5))

```

## Analysis 3.3: identifying the best model and most important predictors

```{r}
# identifying best model 

# areas under the curve 
auc(roc_log)
auc(roc_log2)
auc(roc_nb)
auc(roc_nb2)
auc(roc_dt)
auc(roc_dt2)

# Variable importance from decision tree (life expectancy)

dat_imp <- data.frame(imp = tree_fit$variable.importance)
dat_imp <- dat_imp %>% 
  tibble::rownames_to_column() %>% 
  dplyr::rename("variable" = rowname) %>% 
  dplyr::arrange(imp) %>%
  dplyr::mutate(variable = forcats::fct_inorder(variable))
ggplot2::ggplot(dat_imp) +
  geom_col(aes(x = variable, y = imp),
           col = "black", show.legend = FALSE) +
  coord_flip() +
  scale_fill_grey() +
  theme_bw() + 
  ggtitle("Variable Importance: Life Expectancy (Decision Tree)")

# Variable importance from decision tree (overdose)

dat_imp2 <- data.frame(imp = tree_fit2$variable.importance)
dat_imp2 <- dat_imp2 %>% 
  tibble::rownames_to_column() %>% 
  dplyr::rename("variable" = rowname) %>% 
  dplyr::arrange(imp) %>%
  dplyr::mutate(variable = forcats::fct_inorder(variable))
ggplot2::ggplot(dat_imp2) +
  geom_col(aes(x = variable, y = imp),
           col = "black", show.legend = FALSE) +
  coord_flip() +
  scale_fill_grey() +
  theme_bw() + 
  ggtitle("Variable Importance: Overdose Mortality (Decision Tree)")


```

Table for life Expectancy Prediction models

| Model |Accuracy |Sensitivity | Specificity | AUC |
| :---                |    :----:                     |  :----:                  | :----:           | :----:         |       ---:            |
|Logistic| `r round(CF$overall["Accuracy"], 3)`| `r round(CF$byClass["Sensitivity"], 3)`|`r round(CF$byClass["Specificity"], 3)`| `r round(auc(roc_log), 3)`|
|Naive Bayes| ``r round(CFnb$overall["Accuracy"], 3)`| `r round(CFnb$byClass["Sensitivity"], 3)`|`r round(CFnb$byClass["Specificity"], 3)`| `r round(auc(roc_nb), 3)`|
|Decision Tree | `r round(CFtree$overall["Accuracy"], 3)`| `r round(CFtree$byClass["Sensitivity"], 3)`|`r round(CFtree$byClass["Specificity"], 3)`| `r round(auc(roc_dt), 3)`|

Table for Overdose Mortality Prediction models

| Model |Accuracy |Sensitivity | Specificity | AUC |
| :---                |    :----:                     |  :----:                  | :----:           | :----:         |       ---:            |
|Logistic| `r round(CF2$overall["Accuracy"], 3)`| `r round(CF2$byClass["Sensitivity"], 3)`|`r round(CF2$byClass["Specificity"], 3)`| `r round(auc(roc_log2), 3)`|
|Naive Bayes| ``r round(CFnb2$overall["Accuracy"], 3)`| `r round(CFnb2$byClass["Sensitivity"], 3)`|`r round(CFnb2$byClass["Specificity"], 3)`| `r round(auc(roc_nb2), 3)`|
|Decision Tree | `r round(CFtree2$overall["Accuracy"], 3)`| `r round(CFtree2$byClass["Sensitivity"], 3)`|`r round(CFtree2$byClass["Specificity"], 3)`| `r round(auc(roc_dt2), 3)`|

The three models are close in accuracy, sensitivity, and specificity with the logistic model having slightly higher accuracy for both life expectancy and overdose-related mortality outcomes. The Naive Bayes model has the highest AUC in both. 

In the Decision Tree model for life expectancy, the accuracy (which is how often the classifier is overall correct) is `r round(CFtree$overall["Accuracy"], 3)`. Sensitivity (true positive rate) is `r CFtree$byClass["Sensitivity"]` and specificity (true negative rate) is `r CFtree$byClass["Specificity"]`. The test has somewhat high sensitivity and therefore a lower type II error rate (less false negatives or 1-sensitivity= `r 1- CFtree$byClass["Sensitivity"]` for the false negative rate). Since it has slightly lower (though still high) specificity, it has slightly higher type I error rates (more false positives or 1-specificity=`r 1- CFtree$byClass["Specificity"]` for the false positive rate). 

In the Decision Tree model for overdose-related mortality, the accuracy (which is how often the classifier is overall correct) is `r round(CFtree$overall["Accuracy"], 3)`. This is lower than that in the life expectancy model. Sensitivity (true positive rate) is `r CFtree$byClass["Sensitivity"]` and specificity (true negative rate) is `r CFtree$byClass["Specificity"]`. The test has low sensitivity and therefore a higher type II error rate (more false negatives or 1-sensitivity= `r 1- CFtree$byClass["Sensitivity"]` for the false negative rate). Since it has slightly higher specificity, it has slightly lower type I error rates (more false positives or 1-specificity=`r 1- CFtree$byClass["Specificity"]` for the false positive rate). 

Using the decision tree model to understand variable importance in the model, we generated plots of descending importance. Variable importance looks at the relative influence of each of the included variables in the model and selects those that are split on during the tree building process and compares the improvement of squared errors (which is the difference in squared error between the node and its descendant nodes) as a result of the split. 

Sources: Lecture notes for machine learning (logistic regression, naive bayes, and decision trees), Stack Exchange, and Variable Importance resources found [here] (https://docs.h2o.ai/h2o/latest-stable/h2o-docs/variable-importance.html). 

# Analysis 4: Mapping

```{r, warning=FALSE}
# Loading necessary libraries
library(openxlsx)
library(tidyverse)
library(biscale)
library(rgdal)
library(ggplot2)
library(sf)
library(sp)
library(tibble)
library(cowplot)
library(ggsn)
library(rgeos)
library(raster)
library(staplr)
library(grid)

# Read in county shapefile from US Census TIGER/LINE
county_shp <- rgdal::readOGR(".", layer = "cb_2018_us_county_20m",
                            verbose = F)

# Convert county shapefile to sf object
county_sf <- as(county_shp, "sf")

# Read in state shapefile from US Census TIGER/LINE
state_shp <- rgdal::readOGR(".", layer = "cb_2018_us_state_20m",
                            verbose = F)

# Convert state shapefile to sf object
state_sf <- as(state_shp, "sf")

# Remove Puerto Rico from the state shapefile
state_sf <- state_sf %>% filter(STATEFP != "72")

# Create a new variable that merges the state and county FIPS codes to a single identifier
county_sf <- county_sf %>% mutate(fips = paste(STATEFP, COUNTYFP, sep = ""))

# Reduce the size of the county health rankings data to only the relevant columns
dat_subset <- dplyr::select(dat2, c(fips, Drug.Overdose.Mortality.Rate, Life.Expectancy))

# Join the county health rankings data to the county shapefile
county_sf <- left_join(county_sf, dat_subset, by = c("fips" = "fips"))

# Remove all US territories and non-relevant FIPS codes from the county shapefile
county_sf <- county_sf %>% filter(STATEFP != "14" & STATEFP != "03" & STATEFP != "43" & STATEFP != "52" & STATEFP != "78" & STATEFP != "79" & STATEFP != "74" & STATEFP != "72" & STATEFP != "69" & STATEFP != "70" & STATEFP != "95" & STATEFP != "71" & STATEFP != "76" & STATEFP != "68" & STATEFP != "89" & STATEFP != "67" & STATEFP != "86" & STATEFP != "84" & STATEFP != "66" & STATEFP != "64" & STATEFP != "81" & STATEFP != "60" & COUNTYFP != "016")

# Drop counties in the shapefile that have missing values for drug overdose mortality rate
county_sf_no_od_na <- county_sf %>% filter(is.na(Drug.Overdose.Mortality.Rate) == FALSE)
```

```{r}
# Create the 3-quantile cutoffs based on the distributions of overdose mortality rate and life expectancy
od_le_class <- bi_class(county_sf_no_od_na, x = Drug.Overdose.Mortality.Rate, y = Life.Expectancy, style = "quantile", dim = 3)

# Bivariate map of drug overdose mortality rate and life expectancy excluding Alaska and Hawaii, which will be inset later
map_od_le <- ggplot() +
  geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
          color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkViolet", dim = 3) +
  bi_theme() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        rect = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA)) + 
  geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA)) + 
  geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA))

# Bivariate map of drug overdose mortality rate and life expectancy for Hawaii inset
map_od_le_hi <- ggplot() +
  geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
          color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkViolet", dim = 3) +
  bi_theme() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        rect = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA)) + 
  geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA)) + 
  geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA))

# Bivariate map of drug overdose mortality rate and life expectancy for Alaska inset
map_od_le_ak <- ggplot() +
  geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
          color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkViolet", dim = 3) +
  bi_theme() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        rect = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA)) + 
  geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA)) + 
  geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA))

legend_od_le <- bi_legend(pal = "DkViolet",
                    dim = 3,
                    xlab = "Higher OD Rate",
                    ylab = "Higher LE",
                    size = 8)

# Text box indicating the value cutoffs for the quantiles for each variable
annotation <- ggplot() + 
  annotation_custom(grobTree(textGrob("Quantile Cutoffs\nOD Mortality (deaths/100,000): 3.82, 15.84, 24.92, 126.73\nLE (years): 64.41, 76.19, 78.70, 113.46", x = 0.38,  y = 0.05, hjust = 0, gp = gpar(col = "black", fontsize = 8)))) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA))

# Use cowplot to assemble the map components
od_le_bivariate <- ggdraw() +
  draw_plot(map_od_le, 0, 0, 1, 1) +
  draw_plot(legend_od_le, 0.75, 0.03, 0.25, 0.25) +
  draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
  draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
  draw_plot(annotation)

od_le_bivariate


```

The map shows the joint spatial distribution of drug overdose mortality rate and life expectancy by county. Counties in white have missing information for drug overdose mortality rate. Quantile cutoffs are the most appropriate choice for spatial classification of epidemiological rate data fro presentation, especially when variables such as drug overdose mortality rate are skewed (Brewer and Pickle, 2002).

Areas of high life expectancy and high drug overdose mortality rate are concentrated in the northeast corridor and south Florida. Areas of low life expectancy and low overdose mortality rates are concentrated southern Appalachia and the rural West. Areas of high life expectancy and low overdose mortality rates are concentrated in upper Midwest, east Texas, and the west coast, including Hawaii.

Brewer CA, Pickle L. Evaluation of methods for classifying epidemiological data on choropleth maps in series. Ann Assoc Am Geogr. 2002;92(4):662681.

# Analysis 5: Shiny App

We opted to implement a shiny app that makes our map more interactive. The goal of this analysis was to have users be able to select counties of interest in order to look at the distribution of the outcomes included. The app also includes a second feature which allows users to look at the relative associations of different predictors of interest so that decision makers can look at the relationships across these social determinants and identify intersectoral priorities that could be tackled together to address health-related disparities.  

```{r}
# Final Project Shiny app

# load packages
if (!require("tidyverse"))
  install.packages("tidyverse")
library(tidyverse)
if (!require("shiny"))
  install.packages("shiny")
library(shiny)
if (!require("ggpmisc"))
  install.packages("ggpmisc")
library(ggpmisc)
if (!require("rgdal"))
  install.packages("rgdal")
library(rgdal)
if (!require("sf"))
  install.packages("sf")
library(sf)
if (!require("sp"))
  install.packages("sp")
library(sp)
if (!require("tibble"))
  install.packages("tibble")
library(tibble)
if (!require("cowplot"))
  install.packages("cowplot")
library(cowplot)
if (!require("ggsn"))
  install.packages("ggsn")
library(ggsn)
if (!require("rgeos"))
  install.packages("rgeos")
library(rgeos)
if (!require("grid"))
  install.packages("grid")
library(grid)
if (!require("biscale"))
  install.packages("biscale")
library(biscale)
if (!require("openxlsx"))
  install.packages("openxlsx")
library(openxlsx)

dat <- readRDS("shiny/data/dat.rds") 
# prep dataset for shiny app tab 2
df <- dat %>%
  group_by(state) %>% 
  # create variables to get the mean value within state across counties
  summarise(m_le = mean(Life.Expectancy, na.rm=T), 
            m_od = mean(Drug.Overdose.Mortality.Rate, na.rm=T),
            m_food = mean(`%.Food.Insecure`, na.rm=T),
            m_insure = mean(`%.Uninsured`, na.rm=T),
            m_sleep = mean(`%.Insufficient.Sleep`, na.rm = T),
            m_income = mean(Median.Household.Income, na.rm=T)/1000) %>%
  mutate(rank_le=rank(-m_le),
         rank_od=rank(-m_od))

# prep map data for shiny app
#dat <- read.xlsx("https://www.countyhealthrankings.org/sites/default/files/media/document/2021%20County%20Health%20Rankings%20Data%20-%20v1.xlsx", sheet = 6, startRow = 2)
bivar_map <- readRDS("shiny/data/bivar_map.rds")
county_shp <- rgdal::readOGR("shiny/data", layer = "cb_2018_us_county_20m",
                             verbose = F)
county_sf <- as(county_shp, "sf")
state_shp <- rgdal::readOGR("shiny/data", layer = "cb_2018_us_state_20m",
                            verbose = F)
state_sf <- as(state_shp, "sf")
state_sf <- state_sf %>% filter(STATEFP != "72")
county_sf <- county_sf %>% mutate(fips = paste(STATEFP, COUNTYFP, sep = ""))
dat_subset <- dplyr::select(dat, c(fips, Drug.Overdose.Mortality.Rate, Life.Expectancy))
county_sf <- left_join(county_sf, dat_subset, by = c("fips" = "fips"))
county_sf <- county_sf %>% filter(STATEFP != "14" & STATEFP != "03" & STATEFP != "43" & STATEFP != "52" & STATEFP != "78" & STATEFP != "79" & STATEFP != "74" & STATEFP != "72" & STATEFP != "69" & STATEFP != "70" & STATEFP != "95" & STATEFP != "71" & STATEFP != "76" & STATEFP != "68" & STATEFP != "89" & STATEFP != "67" & STATEFP != "86" & STATEFP != "84" & STATEFP != "66" & STATEFP != "64" & STATEFP != "81" & STATEFP != "60" & COUNTYFP != "016")
county_sf_no_od_na <- county_sf %>% filter(is.na(Drug.Overdose.Mortality.Rate) == FALSE)
od_le_class <- bi_class(county_sf_no_od_na, x = Drug.Overdose.Mortality.Rate, y = Life.Expectancy, style = "quantile", dim = 3)
annotation <- ggplot() + 
  annotation_custom(grobTree(textGrob("Quantile Cutoffs\nOD Mortality (deaths/100,000): 3.82, 15.84, 24.92, 126.73\nLE (years): 64.41, 76.19, 78.70, 113.46", x = 0.38,  y = 0.05, hjust = 0, gp = gpar(col = "black", fontsize = 8)))) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(), 
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(), 
        axis.title = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA))

ui <- fluidPage(
  tabsetPanel(type="tabs",
    tabPanel("Life expectancy and Drug Overdose Mortality Rate", # first tab
             sidebarLayout(
               sidebarPanel(
      selectizeInput("topLE", # life expectancy state rankings
                               "Please specify states for US life expectancy (LE) ranking (highlighted in green):", 
                               c("Top 5", "Bottom 5", unique(df$state)), 
                               selected = "Top 5", multiple = TRUE),
             tableOutput(outputId = "tabLE"),
      selectizeInput("topOD", # drug overdose state rankings
                               "Please specify states for US drug overdose mortality (OD) rate per 100,000 population ranking (highlighted in orange):", 
                               c("Top 5", "Bottom 5", unique(df$state)), 
                               selected = "Top 5", multiple = TRUE),
            tableOutput(outputId = "tabOD")),
      mainPanel(
      plotOutput("le_plot"), # bivariate map
      plotOutput("od_plot")) # bivariate map
    )),
    
  tabPanel("What Are the Driving Factors?", # tab 2
           sidebarLayout(
             sidebarPanel(
           radioButtons("var1", "Please select a factor (x):", # choose variable 1
                                        choices = c("Drug Overdose Mortality Rate (per 100,000 people)" = "m_od",
                                                    "Life Expectancy (years)" = "m_le",
                                                    "% Food Insecure" = "m_food",
                                                    "% Uninsured" = "m_insure",
                                                    "% Insufficient Sleep" = "m_sleep",
                                                    "Median Household Income (thousand USD)" = "m_income"),
                                        selected = c("m_od")),
            radioButtons("var2", "Please select another factor (y):", # choose variable 2
                               choices = c("Drug Overdose Mortality Rate (per 100,000 people)" = "m_od",
                                           "Life Expectancy (years)" = "m_le",
                                           "% Food Insecure" = "m_food",
                                           "% Uninsured" = "m_insure",
                                           "% Insufficient Sleep" = "m_sleep",
                                           "Median Household Income (thousand USD)" = "m_income"),
                               selected = c("m_le"))),
           mainPanel(plotOutput("related_line")) # scatter plot between 2 variables
           )
  )
  )
)


server <- function(input, output) {
# output for le map
    output$le_plot <- renderPlot({
  if (input$topLE=="Top 5") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "06" | 
                                STATEFP == "08" | 
                                STATEFP == "25" | 
                                STATEFP == "27" | 
                                STATEFP == "53"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
  } else if (input$topLE=="Bottom 5") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "01" | 
                              STATEFP == "05" | 
                              STATEFP == "21" | 
                              STATEFP == "28" | 
                              STATEFP == "47"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Alabama") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "01"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Alaska") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "green", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Arizona") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "04"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Arkansas") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "05"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="California") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "06"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Colorado") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "08"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Connecticut") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "09"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Delaware") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "10"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Florida") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "12"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Georgia") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "13"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Hawaii") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "green", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Idaho") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "16"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Illinois") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "17"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Indiana") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "18"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Iowa") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "19"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Kansas") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "20"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Kentucky") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "21"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Louisiana") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "22"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Maine") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "23"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Maryland") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "24"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Massachusetts") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "25"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Michigan") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "26"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Minnesota") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "27"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Mississippi") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "28"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Missouri") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "29"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Montana") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "30"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Nebraska") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "31"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Nevada") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "32"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="New Hampshire") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "33"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="New Jersey") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "34"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="New Mexico") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "35"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="New York") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "36"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="North Carolina") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "37"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="North Dakota") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "38"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Ohio") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "39"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Oklahoma") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "40"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Oregon") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "41"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Pennsylvania") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "42"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Rhode Island") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "44"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="South Carolina") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "45"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="South Dakota") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "46"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Tennessee") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "47"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Texas") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "48"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Utah") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "49"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Vermont") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "50"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Virginia") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "51"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Washington") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "53"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="West Virginia") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "54"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Wisconsin") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "55"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
  } else if (input$topLE=="Wyoming") {
    map_od_le <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "56"), fill = NA, color = "green", size = 0.4, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_hi <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    map_od_le_ak <- ggplot() +
      geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
              color = "white", size = 0.1, show.legend = FALSE) +
      bi_scale_fill(pal = "DkViolet", dim = 3) +
      bi_theme() +
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            rect = element_blank()) + 
      geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA)) + 
      geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
      theme(axis.text.x = element_blank(),
            axis.text.y = element_blank(), 
            axis.ticks.x = element_blank(),
            axis.ticks.y = element_blank(), 
            axis.title = element_blank(),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            panel.background = element_rect(fill = "transparent",colour = NA),
            plot.background = element_rect(fill = "transparent",colour = NA))
    
    legend_od_le <- bi_legend(pal = "DkViolet",
                              dim = 3,
                              xlab = "Higher OD Rate",
                              ylab = "Higher LE",
                              size = 8)
    
    ggdraw() +
      draw_plot(map_od_le, 0, 0, 1, 1) +
      draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
      draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
      draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
      draw_plot(annotation)
  
      } else {bivar_map
      }  
})
  
  # output for drug overdose map
  output$od_plot <- renderPlot({
    if (input$topOD=="Top 5") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "10" | 
                                STATEFP == "24" | 
                                STATEFP == "34" | 
                                STATEFP == "39" | 
                                STATEFP == "54"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
    } else if (input$topOD=="Bottom 5") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "19" | 
                                STATEFP == "31" | 
                                STATEFP == "38" | 
                                STATEFP == "46" | 
                                STATEFP == "48"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Alabama") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "01"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Alaska") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "orange", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Arizona") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "04"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Arkansas") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "05"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="California") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "06"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Colorado") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "08"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Connecticut") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "09"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Delaware") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "10"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Florida") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "12"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Georgia") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "13"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Hawaii") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "orange", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Idaho") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "16"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Illinois") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "17"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Indiana") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "18"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Iowa") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "19"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Kansas") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "20"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Kentucky") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "21"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Louisiana") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "22"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Maine") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "23"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Maryland") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "24"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Massachusetts") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "25"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Michigan") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "26"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Minnesota") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "27"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Mississippi") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "28"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Missouri") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "29"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Montana") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "30"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Nebraska") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "31"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Nevada") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "32"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="New Hampshire") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "33"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="New Jersey") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "34"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="New Mexico") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "35"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="New York") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "36"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="North Carolina") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "37"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="North Dakota") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "38"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Ohio") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "39"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Oklahoma") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "40"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Oregon") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "41"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Pennsylvania") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "42"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Rhode Island") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "44"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="South Carolina") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "45"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="South Dakota") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "46"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Tennessee") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "47"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Texas") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "48"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Utah") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "49"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Vermont") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "50"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Virginia") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "51"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Washington") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "53"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="West Virginia") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "54"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Wisconsin") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "55"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else if (input$topOD=="Wyoming") {
      map_od_le <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP != "15" & STATEFP != "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP != "15" & STATEFP != "02"), fill = NA, color = "black",   size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "56"), fill = NA, color = "orange", size = 0.4, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_hi <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "15"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(county_sf, STATEFP == "15"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(state_sf, STATEFP == "15"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      map_od_le_ak <- ggplot() +
        geom_sf(data = filter(od_le_class, STATEFP == "02"), mapping = aes(fill = bi_class),
                color = "white", size = 0.1, show.legend = FALSE) +
        bi_scale_fill(pal = "DkViolet", dim = 3) +
        bi_theme() +
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              rect = element_blank()) + 
        geom_sf(data = filter(state_sf, STATEFP == "02"), fill = NA, color = "black", size = 0.15, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA)) + 
        geom_sf(data = filter(county_sf, STATEFP == "02"), fill = NA, color = "gray50", size = 0.1, show.legend = FALSE) + 
        theme(axis.text.x = element_blank(),
              axis.text.y = element_blank(), 
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(), 
              axis.title = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
              panel.background = element_rect(fill = "transparent",colour = NA),
              plot.background = element_rect(fill = "transparent",colour = NA))
      
      legend_od_le <- bi_legend(pal = "DkViolet",
                                dim = 3,
                                xlab = "Higher OD Rate",
                                ylab = "Higher LE",
                                size = 8)
      
      ggdraw() +
        draw_plot(map_od_le, 0, 0, 1, 1) +
        draw_plot(legend_od_le, 0.7, 0.01, 0.25, 0.25) +
        draw_plot(map_od_le_hi, 0.2, 0.01, 0.2, 0.2) + 
        draw_plot(map_od_le_ak, -0.07, -0.6, 1.6, 1.6) + 
        draw_plot(annotation)
      
    } else {bivar_map
    }  
  }) 

  
  # output for life expectancy table
  output$tabLE <- renderTable({
    
    # arrange data to rank
    top5_le <- df %>% arrange(desc(m_le)) %>% data.frame %>% slice(1:5) 
    bottom5_le <- df %>% arrange(m_le) %>% data.frame %>% slice(1:5)
    selected_le <- df %>% subset(state %in% input$topLE) %>% arrange(m_le) %>% data.frame
    
    # display rankings
    if (input$topLE=="Top 5") {
      data.frame(cbind("Ranking"=top5_le %>% dplyr::select(rank_le) %>% pull(),
                       "State"=top5_le %>% dplyr::select(state) %>% pull(),
                       "LE"=top5_le %>% dplyr::select(m_le) %>% pull() %>% round(digits = 0)))
    } else if (input$topLE=="Bottom 5") {
      data.frame(cbind("Ranking"=bottom5_le %>% dplyr::select(rank_le) %>% pull(),
                       "State"=bottom5_le %>% dplyr::select(state) %>% pull(),
                       "LE"=bottom5_le %>% dplyr::select(m_le) %>% pull() %>% round(digits = 0)))
    } else {
      data.frame(cbind("Ranking"=selected_le %>% dplyr::select(rank_le) %>% pull(),
                       "State"=selected_le %>% dplyr::select(state) %>% pull(),
                       "LE"=selected_le %>% dplyr::select(m_le) %>% pull() %>% round(digits = 0)))
    }
    
  })
  
  # output for drug overdose table
  output$tabOD <- renderTable({
    
    # arrange data to rank
    top5_od <- df %>% arrange(desc(m_od)) %>% data.frame %>% slice(1:5) 
    bottom5_od <- df %>% arrange(m_od) %>% data.frame %>% slice(1:5)
    selected_od <- df %>% subset(state %in% input$topod) %>% arrange(m_od) %>% data.frame
    
    # display rankings
    if (input$topOD=="Top 5") {
      data.frame(cbind("Ranking"=top5_od %>% dplyr::select(rank_od) %>% pull(),
                       "State"=top5_od %>% dplyr::select(state) %>% pull(),
                       "OD"=top5_od %>% dplyr::select(m_od) %>% pull() %>% round(digits = 0)))
    } else if (input$topOD=="Bottom 5") {
      data.frame(cbind("Ranking"=bottom5_od %>% dplyr::select(rank_od) %>% pull(),
                       "State"=bottom5_od %>% dplyr::select(state) %>% pull(),
                       "OD"=selected_od %>% dplyr::select(m_od) %>% pull() %>% round(digits = 0)))
    } else {
      data.frame(cbind("Ranking"=selected_od %>% dplyr::select(rank_od) %>% pull(),
                       "State"=selected_od %>% dplyr::select(state) %>% pull(),
                       "OD"=selected_od %>% dplyr::select(m_od) %>% pull() %>% round(digits = 0)))
    }
    
  })
  
  
  output$related_line <- renderPlot({
    # prep data and omit missing data
    df_b3 <- df %>%
      dplyr::select(state, input$var1, input$var2) %>%
      na.omit() %>% 
      data.frame()
    
    # specify formula for formula labeling later
    my.formula <- y ~ x
    
    # reactive x-axis label
    x_label <- reactive({
      req(input$var1)
      if(input$var1 == "m_od"){
        x_label <- "Drug Overdose Mortality Rate (per 100,000 people)"
      } else if(input$var1 == "m_le"){
        x_label <- "Life Expectancy (years)"
      } else if(input$var1 == "m_food"){
        x_label <- "% Food Insecure"
      } else if(input$var1 == "m_insure"){
        x_label <- "% Uninsured"
      } else if(input$var1 == "m_sleep"){
        x_label <- "% Insufficient Sleep"
      } else if(input$var1 == "m_income"){
        x_label <- "Median Household Income (thousand USD)"
      } else if(input$var1 == "m_cases"){
        x_label <- "Covid-19 case rate (per 100,000 people)"
      }
    })
    
    # reactive y-axis label
    y_label <- reactive({
      req(input$var2)
      if(input$var2 == "m_od"){
        y_label <- "Drug Overdose Mortality Rate (per 100,000 people)"
      } else if(input$var2 == "m_le"){
        y_label <- "Life Expectancy (years)"
      } else if(input$var2 == "m_food"){
        y_label <- "% Food Insecure"
      } else if(input$var2 == "m_insure"){
        y_label <- "% Uninsured"
      } else if(input$var2 == "m_sleep"){
        y_label <- "% Insufficient Sleep"
      } else if(input$var2 == "m_income"){
        y_label <- "Median Household Income (thousand USD)"
      } else if(input$var1 == "m_cases"){
        x_label <- "Covid-19 case rate (per 100,000 people)"
      }
    })
    
    # scattor plot between 2 variables
    ggplot(data=df_b3, aes(x = df_b3[,input$var1], y = df_b3[,input$var2])) +
      geom_point(size = 1) + 
      ggtitle("Are these variables related?") +
      theme(plot.title = element_text(size = 10)) + 
      xlab(paste(x_label(), "(x)")) + 
      ylab(paste(y_label(), "(y)")) + 
      theme_bw() +
      geom_smooth(method = "lm", formula = my.formula) +
      stat_poly_eq(formula = my.formula, 
                   aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
                   parse = TRUE)
    
  })
    
}

# Run the application (this will not be visible on the static RMD but is available in the shiny folder on github)
shinyApp(ui = ui, server = server)

```

